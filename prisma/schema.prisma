generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
  IN_PROGRESS
}

enum JourneyType {
  ONWARD
  RETURN
}

enum PaymentMethod {
  CASH
  CARD
  NET_BANKING
  WALLET
}

model User {
  id                    String    @id @default(auto()) @map("_id") @db.ObjectId
  firstName             String
  lastName              String
  email                 String    @unique
  password              String?
  phoneNumber           String
  resetToken            String?
  resetTokenExpiry      DateTime?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  bookings              Booking[] @relation("UserBookings")
  
  @@map("users")
}

type PassengerDetails {
  firstName   String
  lastName    String
  email       String?
  phoneNumber String?
}

model Booking {
  id                String              @id @default(auto()) @map("_id") @db.ObjectId  
  userId            String?             @db.ObjectId
  user              User?               @relation("UserBookings", fields: [userId], references: [id])
  guestFirstName    String?
  guestLastName     String?
  guestEmail        String?
  guestPhoneNumber  String?
  onwardJourneyId   String              @unique @db.ObjectId
  onwardJourney     Journey             @relation("OnwardJourney", fields: [onwardJourneyId], references: [id])
  returnEnabled     Boolean             @default(false)
  returnJourneyId   String?             @unique @db.ObjectId
  returnJourney     Journey?            @relation("ReturnJourney", fields: [returnJourneyId], references: [id])
  paymentMethod     PaymentMethod?
  totalAmount       Float?
  paymentStatus     PaymentStatus       @default(PENDING)
  status            BookingStatus       @default(PENDING)
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  
  @@map("bookings")
}

model Journey {
  id                String      @id @default(auto()) @map("_id") @db.ObjectId
  journeyType       JourneyType
  serviceType       String 
  pickupDate        String
  pickupTime        String
  pickupLocation    String
  stops             String[]  @default([])
  dropoffLocation   String
  passengers        Int       @default(1)
  luggage           Int       @default(0)
  passengerDetails  PassengerDetails[]
  vehicleType       String? 
  remarks           String?
  onwardBooking     Booking?  @relation("OnwardJourney")
  returnBooking     Booking?  @relation("ReturnJourney")
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  
  @@map("journeys")
}

type JourneyData {
  journeyType       String
  serviceType       String
  pickupDate        String
  pickupTime        String
  pickupLocation    String
  stops             String[]
  dropoffLocation   String
  passengers        Int
  luggage           Int
  passengerDetails  PassengerDetails[]
  vehicleType       String?
  remarks           String?
}

model PaymentSession {
  id                String              @id @default(auto()) @map("_id") @db.ObjectId
  sessionId         String              @unique
  userId            String?             @db.ObjectId
  guestFirstName    String?
  guestLastName     String?
  guestEmail        String?
  guestPhoneNumber  String?
  totalAmount       Float?
  returnEnabled     Boolean             @default(false)
  passengers        PassengerDetails[]
  onwardJourney     JourneyData
  returnJourney     JourneyData?
  expiresAt         DateTime
  createdAt         DateTime            @default(now())
  
  @@map("payment_sessions")
  @@index([userId])
  @@index([expiresAt])
}